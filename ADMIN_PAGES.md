# ChatPack - 后台管理页面规范

## 概述

本文档描述 ChatPack（单词十连抽）项目所有管理员后台页面的功能和设计要点。

---

## 页面列表

| 页面 | 路径 | 说明 | 优先级 |
|------|------|------|--------|
| 数据统计仪表盘 | `/admin` 或 `/admin/dashboard` | 数据概览和图表 | ⭐⭐⭐ |
| 单词管理 | `/admin/words` | 单词增删改查、批量导入 | ⭐⭐⭐ |
| 单词书管理 | `/admin/wordbooks` | 单词书管理、分配单词 | ⭐⭐⭐ |
| 聊天室管理 | `/admin/rooms` | 聊天室配置 | ⭐⭐⭐ |
| 用户管理 | `/admin/users` | 用户列表、封禁、赠送 | ⭐⭐⭐ |
| 卡包管理 | `/admin/packs` | 卡包配置 | ⭐⭐⭐ |
| 系统设置 | `/admin/settings` | 全局配置 | ⭐⭐ |

---

## 1. 数据统计仪表盘

**路径:** `/admin` 或 `/admin/dashboard`

**功能:**
- 核心数据卡片展示
  - 总用户数、今日活跃、本周新增、封禁数
  - 单词总数、稀有度分布
  - 卡包总开包数、本周开包、库存总数
  - 消息总数、今日消息、总鲜花数
  - 聊天室数量、在线用户数

- 数据可视化图表
  - 用户增长趋势图（折线图）
  - 单词稀有度分布图（饼图）
  - 开包数据趋势（柱状图）
  - 消息活跃度热力图

- 快捷操作
  - 跳转到各管理页面
  - 查看最新用户
  - 查看最新消息

**API 接口:**
- `GET /api/admin/dashboard` - 获取统计数据

**UI 组件建议:**
- 使用 shadcn/ui 的 Card 组件展示数据卡片
- 使用 recharts 或 chart.js 绘制图表
- 响应式网格布局

---

## 2. 单词管理

**路径:** `/admin/words`

**功能:**

### 2.1 单词列表
- 表格展示所有单词
- 显示字段：单词、释义、音标、稀有度、所属单词书、创建时间
- 支持搜索（单词或释义）
- 支持筛选（稀有度、单词书）
- 支持排序（创建时间、单词字母序）
- 分页加载

### 2.2 添加单词
- 表单字段：
  - 单词（必填）
  - 中文释义（必填）
  - 音标（可选）
  - 稀有度（必选：COMMON/RARE/EPIC/LEGENDARY）
  - 例句（可选）
  - 卡牌图片URL（可选）
  - 发音音频URL（可选）
  - 所属单词书（多选，至少一个）
- 表单验证
- 保存后刷新列表

### 2.3 编辑单词
- 同添加表单
- 预填充现有数据
- 支持修改所有字段

### 2.4 删除单词
- 确认对话框
- 提示删除影响（用户库存、开包等）
- 级联删除相关数据

### 2.5 批量导入
- 上传 CSV/JSON 文件
- 文件格式说明
- 导入进度显示
- 导入结果报告（成功数、失败数、错误列表）
- 下载导入模板

**API 接口:**
- `GET /api/words` - 获取单词列表
- `POST /api/words` - 创建单词
- `PUT /api/words/:id` - 更新单词
- `DELETE /api/words/:id` - 删除单词
- `POST /api/words/batch-import` - 批量导入

**UI 组件建议:**
- Table 组件（数据表格）
- Dialog 组件（添加/编辑对话框）
- Select 组件（稀有度、单词书选择）
- Input 组件（搜索、表单输入）
- File Upload 组件（批量导入）

---

## 3. 单词书管理

**路径:** `/admin/wordbooks`

**功能:**

### 3.1 单词书列表
- 显示所有单词书（6个等级）
- 显示字段：名称、等级、描述、单词数、状态
- 启用/禁用切换

### 3.2 编辑单词书
- 编辑名称
- 编辑描述
- 切换启用状态
- 不可编辑：等级（固定）

### 3.3 管理单词书中的单词
- 查看单词书包含的所有单词
- 添加单词到单词书（从全部单词中选择）
- 从单词书移除单词
- 搜索和筛选
- 批量添加/移除

**API 接口:**
- `GET /api/wordbooks` - 获取单词书列表
- `PUT /api/wordbooks/:id` - 更新单词书
- `GET /api/wordbooks/:id/words` - 获取单词书中的单词
- `POST /api/wordbooks/:id/words` - 添加单词
- `DELETE /api/wordbooks/:id/words/:wordId` - 移除单词

**UI 组件建议:**
- Card 组件（单词书卡片）
- Switch 组件（启用/禁用）
- Dialog 组件（编辑对话框）
- Multi-Select 组件（选择单词）

---

## 4. 聊天室管理

**路径:** `/admin/rooms`

**功能:**

### 4.1 聊天室列表
- 显示所有聊天室
- 显示字段：名称、环境等级、描述、状态、在线人数
- 启用/禁用切换

### 4.2 创建聊天室
- 表单字段：
  - 名称（必填）
  - 环境等级（必选：PRIMARY/MIDDLE/HIGH/CET4/CET6/POSTGRADUATE）
  - 描述（可选）
- 每个环境等级只能有一个聊天室

### 4.3 编辑聊天室
- 编辑名称
- 编辑描述
- 切换启用状态
- 不可编辑：环境等级（唯一约束）

### 4.4 删除聊天室
- 确认对话框
- 警告：将删除所有该聊天室的消息
- 级联删除

### 4.5 查看聊天室详情
- 查看最近消息
- 查看在线用户
- 消息统计

**API 接口:**
- `GET /api/admin/rooms` - 获取所有聊天室
- `POST /api/admin/rooms` - 创建聊天室
- `PUT /api/admin/rooms/:id` - 更新聊天室
- `DELETE /api/admin/rooms/:id` - 删除聊天室

**UI 组件建议:**
- Table 组件（聊天室列表）
- Dialog 组件（创建/编辑）
- Badge 组件（在线人数、状态）
- Alert Dialog 组件（删除确认）

---

## 5. 用户管理

**路径:** `/admin/users`

**功能:**

### 5.1 用户列表
- 表格展示所有用户
- 显示字段：用户名、昵称、角色、状态、注册时间、最后登录
- 支持搜索（用户名或昵称）
- 支持筛选（角色、封禁状态）
- 支持排序（注册时间、最后登录）
- 分页加载

### 5.2 查看用户详情
- 基本信息：用户名、昵称、头像、角色
- 统计信息：总鲜花、总开包数、单词收集数
- 邀请信息：邀请码、邀请人
- 操作记录：注册时间、最后登录

### 5.3 封禁/解封用户
- 封禁理由（可选）
- 封禁后用户无法登录
- 支持批量封禁

### 5.4 赠送卡包
- 选择卡包类型
- 输入数量
- 添加备注
- 确认后即时到账

### 5.5 查看用户库存
- 单词库存列表
- 卡包库存列表
- 开包历史记录

**API 接口:**
- `GET /api/admin/users` - 获取用户列表
- `GET /api/users/:id` - 获取用户详情
- `PUT /api/admin/users/:id/ban` - 封禁/解封
- `POST /api/admin/users/:id/packs` - 赠送卡包

**UI 组件建议:**
- Table 组件（用户列表）
- Dialog 组件（用户详情、赠送卡包）
- Badge 组件（角色、状态）
- Switch 组件（封禁切换）

---

## 6. 卡包管理

**路径:** `/admin/packs`

**功能:**

### 6.1 卡包列表
- 显示所有卡包（4种稀有度）
- 显示字段：名称、稀有度类型、卡片数量、状态、创建时间
- 启用/禁用切换

### 6.2 创建卡包
- 表单字段：
  - 名称（必填）
  - 描述（可选）
  - 卡片数量（必填，默认5）
  - 稀有度类型（必选：COMMON/RARE/EPIC/LEGENDARY）
- 每个稀有度只能有一个卡包

### 6.3 编辑卡包
- 编辑名称
- 编辑描述
- 修改卡片数量
- 切换启用状态
- 不可编辑：稀有度类型（唯一约束）

### 6.4 删除卡包
- 确认对话框
- 警告：将影响用户库存
- 级联删除

### 6.5 查看卡包统计
- 总开包次数
- 最近开包记录
- 用户库存统计

**API 接口:**
- `GET /api/admin/packs` - 获取所有卡包
- `POST /api/admin/packs` - 创建卡包
- `PUT /api/admin/packs/:id` - 更新卡包
- `DELETE /api/admin/packs/:id` - 删除卡包

**UI 组件建议:**
- Card 组件（卡包卡片）
- Dialog 组件（创建/编辑）
- Input 组件（表单输入）
- Select 组件（稀有度选择）

---

## 7. 系统设置

**路径:** `/admin/settings`

**功能:**（可选功能，根据需要实现）

### 7.1 全局配置
- 网站名称
- 网站描述
- Logo URL
- 联系方式

### 7.2 功能开关
- 注册开关
- 邀请码必填
- 聊天室启用
- 开包功能启用

### 7.3 系统参数
- 默认新手卡包
- 最大上传文件大小
- 分页默认大小
- 缓存时间设置

### 7.4 邮件设置
- SMTP 配置
- 邮件模板

**API 接口:**
- `GET /api/admin/settings` - 获取所有设置
- `PUT /api/admin/settings` - 更新设置

**UI 组件建议:**
- Tabs 组件（分类设置）
- Form 组件（设置表单）
- Switch 组件（开关）

---

## 通用设计要点

### 1. 布局结构
```
+--------------------------------------------------+
| Logo | 后台管理                    [用户头像]    |
+----------+---------------------------------------+
| 侧边栏   |              主内容区                 |
| - 仪表盘 |                                       |
| - 单词   |                                       |
| - 单词书 |                                       |
| - 聊天室 |                                       |
| - 用户   |                                       |
| - 卡包   |                                       |
| - 设置   |                                       |
+----------+---------------------------------------+
```

### 2. 权限控制
- 所有后台页面需要管理员权限
- 未登录重定向到登录页
- 非管理员显示403错误

### 3. 响应式设计
- 桌面端：侧边栏固定，主内容区自适应
- 移动端：侧边栏可折叠，响应式表格

### 4. 用户体验
- 操作反馈：Toast 提示成功/失败
- 加载状态：Skeleton 或 Spinner
- 确认对话框：危险操作需要二次确认
- 表单验证：实时验证和错误提示

### 5. 性能优化
- 列表数据分页加载
- 图片懒加载
- 搜索防抖
- 缓存常用数据

### 6. 技术栈
- **框架:** Next.js 14 App Router
- **UI 组件:** shadcn/ui
- **样式:** Tailwind CSS
- **状态管理:** Zustand
- **表单:** React Hook Form + Zod
- **图表:** Recharts
- **表格:** TanStack Table

---

## 开发优先级

### Phase 1 - 核心管理（MVP）
1. ⭐⭐⭐ 数据统计仪表盘（基础版）
2. ⭐⭐⭐ 单词管理（增删改查）
3. ⭐⭐⭐ 单词书管理
4. ⭐⭐⭐ 用户管理（查看、封禁）

### Phase 2 - 扩展功能
5. ⭐⭐⭐ 聊天室管理
6. ⭐⭐⭐ 卡包管理
7. ⭐⭐ 单词批量导入
8. ⭐⭐ 用户赠送卡包

### Phase 3 - 优化完善
9. ⭐⭐ 数据统计图表
10. ⭐ 系统设置
11. ⭐ 高级筛选和搜索
12. ⭐ 操作日志

---

**文档版本**: 1.0  
**创建日期**: 2026-01-12  
**作者**: GitHub Copilot  
**项目**: ChatPack 后台管理
